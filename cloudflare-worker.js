/**
 * Workers.js ä»£ç é«˜äº®å·¥å…· - Cloudflare Workers å…¥å£æ–‡ä»¶
 */

export default {
  async fetch(request, env, ctx) {
    const corsHeaders = {
      'Access-Control-Allow-Origin': '*',
      'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',
      'Access-Control-Allow-Headers': 'Content-Type, Authorization',
    };

    if (request.method === 'OPTIONS') {
      return new Response(null, {
        status: 200,
        headers: corsHeaders,
      });
    }

    // HTML content without loadExample
    const htmlContent = '<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Workers.js ä»£ç é«˜äº®å·¥å…·</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}.container{max-width:1400px;margin:0 auto;background:rgba(255,255,255,0.95);border-radius:15px;box-shadow:0 20px 40px rgba(0,0,0,0.1);overflow:hidden}header{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:white;padding:30px;text-align:center}header h1{font-size:2.5em;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}header p{font-size:1.2em;opacity:0.9}.main-content{display:grid;grid-template-columns:1fr 1fr;gap:20px;padding:30px}.editor-section,.preview-section{background:white;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.08);overflow:hidden}.section-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:15px 20px;font-weight:bold;display:flex;justify-content:space-between;align-items:center}.editor-wrapper,.preview-wrapper{padding:20px;height:500px;overflow:auto}#codeInput{width:100%;height:100%;border:2px solid #e0e0e0;border-radius:8px;padding:15px;font-family:"Consolas","Monaco","Courier New",monospace;font-size:14px;resize:none;outline:none;transition:border-color 0.3s}#codeInput:focus{border-color:#667eea}#highlightedOutput{width:100%;height:100%;border:2px solid #e0e0e0;border-radius:8px;padding:15px;font-family:"Consolas","Monaco","Courier New",monospace;font-size:14px;background:#f8f9fa;overflow:auto;white-space:pre-wrap;word-wrap:break-word}.controls{padding:20px 30px;background:#f8f9fa;display:flex;gap:15px;flex-wrap:wrap;justify-content:center}button{padding:12px 24px;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;gap:8px}.btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}.btn-primary:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,0.4)}.btn-secondary{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:white}.btn-secondary:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(240,147,251,0.4)}.btn-danger{background:linear-gradient(135deg,#ff6b6b 0%,#ee5a24 100%);color:white}.btn-danger:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(255,107,107,0.4)}.stats{padding:20px 30px;background:white;display:flex;justify-content:space-around;border-top:1px solid #e0e0e0}.stat-item{text-align:center}.stat-value{font-size:24px;font-weight:bold;color:#667eea;display:block}.stat-label{color:#666;font-size:14px;margin-top:5px}.keyword{color:#d73a49;font-weight:bold}.function{color:#6f42c1}.string{color:#032f62}.comment{color:#6a737d;font-style:italic}.number{color:#005cc5}.workers-specific{color:#e36209;font-weight:bold}.bracket{color:#24292e;font-weight:bold}.operator{color:#d73a49}.toast{position:fixed;top:20px;right:20px;background:#28a745;color:white;padding:15px 20px;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,0.2);opacity:0;transform:translateY(-20px);transition:all 0.3s;z-index:1000}.toast.show{opacity:1;transform:translateY(0)}@media (max-width:768px){.main-content{grid-template-columns:1fr}header h1{font-size:2em}.controls{flex-direction:column;align-items:stretch}}</style></head><body><div class="container"><header><h1>ğŸš€ Workers.js ä»£ç é«˜äº®å·¥å…·</h1><p>ä¸“ä¸º Cloudflare Workers.js è®¾è®¡çš„åœ¨çº¿ä»£ç é«˜äº®å’Œæ ¼å¼åŒ–å·¥å…·</p></header><div class="main-content"><div class="editor-section"><div class="section-header"><span>ğŸ“ ä»£ç ç¼–è¾‘å™¨</span><span id="inputStats">0 è¡Œ Â· 0 å­—ç¬¦</span></div><div class="editor-wrapper"><textarea id="codeInput" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„ Workers.js ä»£ç ..."></textarea></div></div><div class="preview-section"><div class="section-header"><span>ğŸ¨ é«˜äº®é¢„è§ˆ</span><span id="outputStats">0 è¡Œ Â· 0 å…³é”®å­—</span></div><div class="preview-wrapper"><div id="highlightedOutput"></div></div></div></div><div class="controls"><button class="btn-primary" onclick="highlightCode()"><span>âœ¨</span> é«˜äº®ä»£ç </button><button class="btn-secondary" onclick="copyCode()"><span>ğŸ“‘</span> å¤åˆ¶ä»£ç </button><button class="btn-danger" onclick="clearAll()"><span>ğŸ—‘ï¸</span> æ¸…ç©ºå†…å®¹</button></div><div class="stats"><div class="stat-item"><span class="stat-value" id="lineCount">0</span><div class="stat-label">è¡Œæ•°</div></div><div class="stat-item"><span class="stat-value" id="charCount">0</span><div class="stat-label">å­—ç¬¦æ•°</div></div><div class="stat-item"><span class="stat-value" id="keywordCount">0</span><div class="stat-label">å…³é”®å­—æ•°</div></div><div class="stat-item"><span class="stat-value" id="functionCount">0</span><div class="stat-label">å‡½æ•°æ•°</div></div></div></div><div id="toast" class="toast"></div><script>const jsKeywords=["break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","false","finally","for","function","if","import","in","instanceof","let","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with","yield","async","await"];const workersObjects=["addEventListener","removeEventListener","fetch","request","response","Request","Response","Headers","URL","URLSearchParams","DurableObject","KVNamespace","R2Bucket","Cache","crypto","console","setTimeout","clearTimeout","setInterval","clearInterval","atob","btoa","WebSocket","TransformStream","ReadableStream","WritableStream","env","ctx","waitUntil"];let highlightTimeout;document.addEventListener("DOMContentLoaded",function(){const codeInput=document.getElementById("codeInput");codeInput.addEventListener("input",handleInput);codeInput.addEventListener("keydown",handleKeydown)});function handleInput(){clearTimeout(highlightTimeout);updateInputStats();highlightTimeout=setTimeout(function(){highlightCode()},500)}function handleKeydown(e){if((e.ctrlKey||e.metaKey)&&e.key==="Enter"){e.preventDefault();highlightCode()}else if((e.ctrlKey||e.metaKey)&&e.key==="l"){e.preventDefault();clearAll()}else if((e.ctrlKey||e.metaKey)&&e.shiftKey&&e.key==="C"){e.preventDefault();copyCode()}}function highlightCode(){const code=document.getElementById("codeInput").value;if(!code.trim()){document.getElementById("highlightedOutput").innerHTML="";updateStats(0,0,0,0);return}let highlighted=code;let keywordCount=0;let functionCount=0;highlighted=highlighted.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");highlighted=highlighted.replace(/\\/\\/.*$/gm,function(match){return \'<span class="comment">\'+match+\'</span>\'});highlighted=highlighted.replace(/\\/\\*[\\s\\S]*?\\*\\//g,function(match){return \'<span class="comment">\'+match+\'</span>\'});const stringRegex=new RegExp(\'(["\\\'`])((?:\\\\\\\\.|(?!\\\\1)[^\\\\\\\\])*)\\\\1\',\'g\');highlighted=highlighted.replace(stringRegex,\'<span class="string">$1$2$1</span>\');highlighted=highlighted.replace(/\\b(\\d+\\.?\\d*)\\b/g,\'<span class="number">$1</span>\');workersObjects.forEach(function(obj){const regex=new RegExp(\'\\\\\\\\b\'+obj+\'\\\\\\\\b\',\'g\');highlighted=highlighted.replace(regex,\'<span class="workers-specific">\'+obj+\'</span>\')});jsKeywords.forEach(function(keyword){const regex=new RegExp(\'\\\\\\\\b\'+keyword+\'\\\\\\\\b\',\'g\');highlighted=highlighted.replace(regex,function(match){keywordCount++;return \'<span class="keyword">\'+match+\'</span>\'})});highlighted=highlighted.replace(/\\b([a-zA-Z_$][a-zA-Z0-9_$]*)\\s*\\(/g,\'<span class="function">$1</span>(\');functionCount=(highlighted.match(/<span class="function">/g)||[]).length;highlighted=highlighted.replace(/([{}()\\[\\]])/g,\'<span class="bracket">$1</span>\');const operators=["+","-","*","/","==","===","!=","!==",">","<",">=","<=","&&","||","!","++","--","%","&","|","^","~","<<",">>",">>>","+=","-=","*=","/=","%=","&=","|=","^=","<<=",">>=",">>>="];operators.forEach(function(op){const escapedOp=op.replace(/[.*+?^${}()|[\\]\\\\\\\\]/g,\'\\\\\\\\$&\');const regex=new RegExp(\'\\\\\\\\s*(\'+escapedOp+\')\\\\\\\\s*\',\'g\');highlighted=highlighted.replace(regex,\' <span class="operator">$1</span> \')});document.getElementById("highlightedOutput").innerHTML=highlighted;const lines=code.split(\'\\n\').length;const chars=code.length;updateStats(lines,chars,keywordCount,functionCount);showToast("ä»£ç é«˜äº®å®Œæˆï¼")}function updateStats(lines,chars,keywords,functions){document.getElementById("lineCount").textContent=lines;document.getElementById("charCount").textContent=chars;document.getElementById("keywordCount").textContent=keywords;document.getElementById("functionCount").textContent=functions}function updateInputStats(){const code=document.getElementById("codeInput").value;const lines=code.split(\'\\n\').length;const chars=code.length;document.getElementById("inputStats").textContent=lines+" è¡Œ Â· "+chars+" å­—ç¬¦"}function copyCode(){const code=document.getElementById("codeInput").value;navigator.clipboard.writeText(code).then(function(){showToast("ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼")}).catch(function(){const textarea=document.createElement("textarea");textarea.value=code;document.body.appendChild(textarea);textarea.select();document.execCommand("copy");document.body.removeChild(textarea);showToast("ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼")})}function clearAll(){document.getElementById("codeInput").value="";document.getElementById("highlightedOutput").innerHTML="";updateStats(0,0,0,0);document.getElementById("inputStats").textContent="0 è¡Œ Â· 0 å­—ç¬¦";document.getElementById("outputStats").textContent="0 è¡Œ Â· 0 å…³é”®å­—";showToast("å†…å®¹å·²æ¸…ç©ºï¼")}function showToast(message){const toast=document.getElementById("toast");toast.textContent=message;toast.classList.add("show");setTimeout(function(){toast.classList.remove("show")},3000)}</script></body></html>';

    return new Response(htmlContent, {
      status: 200,
      headers: {
        'Content-Type': 'text/html; charset=UTF-8',
        ...corsHeaders,
      },
    });
  }
};
